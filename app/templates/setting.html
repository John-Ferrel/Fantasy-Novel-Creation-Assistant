<!DOCTYPE html>
<html>
<head>
    <title>{{ project.title }} - è®¾å®š</title>
    <style>
        /* å…±ç”¨ä¾§è¾¹æ æ ·å¼ */
        body { 
            margin: 0; 
            display: flex; 
            font-family: Arial;
        }
        #sidebar {
            width: 250px;
            background: #f8f9fa;
            padding: 20px;
            height: 100vh;
            border-right: 1px solid #ddd;
        }
        #content {
            flex: 1;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* è®¾å®šé¡µé¢ç‰¹æœ‰æ ·å¼ */
        .setting-block {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .category-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .content {
            margin-top: 10px;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        button {
            margin-top: 10px;
            padding: 8px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹æ  (ä¸ novel.html ä¿æŒä¸€è‡´) -->
    <div id="sidebar">
        <h3>{{ project.title }}</h3>
        <div style="margin: 15px 0;">
            <button onclick="location.href='/project/{{ project.id }}'">â† è¿”å›åˆ›ä½œ</button>
        </div>
        <h4>å¿«æ·å¯¼èˆª</h4>
        <div style="margin: 5px 0;">
            <a href="/project/{{ project.id }}">ç« èŠ‚ç›®å½•</a>
        </div>
        <div style="margin: 15px 0;">
            <button onclick="window.location.href='/'">â† è¿”å›é¡¹ç›®åˆ—è¡¨</button>
        </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div id="content">
        <h1>è®¾å®šç®¡ç†</h1>
        <div id="settings">
            {% for setting in settings %}
            <div class="setting-block">
                <input class="category-input" 
                       value="{{ setting.category }}"
                       placeholder="è®¾å®šç±»åˆ«ï¼ˆå¦‚ï¼šä¿®ç‚¼ä½“ç³»ï¼‰">
                <div class="content" contenteditable>{{ setting.content }}</div>
                <div class="controls">
                    <button onclick="generateText(this, 'ç»­å†™')">ç»­å†™</button>
                    <button onclick="generateText(this, 'æ‰©å†™')">æ‰©å†™</button>
                </div>
            </div>
            {% endfor %}
        </div>

        <div style="margin-top:20px;">
            <button onclick="addSetting()">+ æ–°å¢è®¾å®šç±»åˆ«</button>
            <button onclick="saveSettings()" style="background:#007bff">ğŸ’¾ ä¿å­˜æ‰€æœ‰è®¾å®š</button>
        </div>
    </div>

    <script>
        // ä¿æŒåŸæœ‰è„šæœ¬ä¸å˜
        function addSetting() {
            const html = `
                <div class="setting-block">
                    <input class="category-input" placeholder="è®¾å®šç±»åˆ«">
                    <div class="content" contenteditable></div>
                    <div class="controls">
                        <button onclick="generateText(this, 'ç»­å†™')">ç»­å†™</button>
                        <button onclick="generateText(this, 'æ‰©å†™')">æ‰©å†™</button>
                    </div>
                </div>
            `;
            document.getElementById('settings').insertAdjacentHTML('beforeend', html);
        }

        async function saveSettings() {
            const settingsData = Array.from(document.querySelectorAll('.setting-block')).map(block => ({
                category: block.querySelector('.category-input').value,
                content: block.querySelector('.content').innerHTML
            }));
            
            const res = await fetch('/setting/{{ project.id }}', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(settingsData)
            });
            
            if (res.ok) alert('ä¿å­˜æˆåŠŸï¼');
        }

        async function generateText(button, action) {
            const block = button.closest('.setting-block');
            const currentText = block.querySelector('.content').innerHTML;
            
            const res = await fetch('/generate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    action: action,
                    current_text: currentText,
                    project_id: {{ project.id }}
                })
            });
            const data = await res.json();
            
            block.querySelector('.content').innerHTML = 
                action === 'ç»­å†™' ? currentText + data.generated_text : data.generated_text;
        }
    </script>
</body>
</html>